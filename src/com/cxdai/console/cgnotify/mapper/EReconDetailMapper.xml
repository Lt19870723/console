<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cxdai.console.cgnotify.mapper.EReconDetailMapper" >
  <resultMap id="BaseResultMap" type="com.cxdai.console.cgnotify.entity.EReconDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="HEADER_ID" property="headerId" jdbcType="INTEGER" />
    <result column="TARGET_TYPE" property="targetType" jdbcType="TINYINT" />
    <result column="TARGET_ID" property="targetId" jdbcType="VARCHAR" />
    <result column="TARGET_NAME" property="targetName" jdbcType="VARCHAR" />
    <result column="P2P_NO" property="p2pNo" jdbcType="VARCHAR" />
    <result column="BANK_NO" property="bankNo" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="TINYINT" />
    <result column="TRADETIME" property="tradetime" jdbcType="TIMESTAMP" />
    <result column="MONEY" property="money" jdbcType="DECIMAL" />
    <result column="MONEY2" property="money2" jdbcType="DECIMAL" />
    <result column="FEE" property="fee" jdbcType="DECIMAL" />
    <result column="STATUS2" property="status2" jdbcType="TINYINT" />
    <result column="STATUS3" property="status3" jdbcType="TINYINT" />
    <result column="EXP_TYPE" property="expType" jdbcType="TINYINT" />
    <result column="EXP1" property="exp1" jdbcType="VARCHAR" />
    <result column="EXP2" property="exp2" jdbcType="VARCHAR" />
    <result column="ADDUSER" property="adduser" jdbcType="INTEGER" />
    <result column="ADDTIME" property="addtime" jdbcType="TIMESTAMP" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="FILE_NAME" property="fileName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    ID, HEADER_ID, TARGET_TYPE, TARGET_ID, TARGET_NAME, P2P_NO, BANK_NO, STATUS, TRADETIME,
    MONEY, MONEY2, FEE, STATUS2, STATUS3, EXP_TYPE, EXP1, EXP2, ADDUSER, ADDTIME, REMARK,
    FILE_NAME
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    select
    <include refid="Base_Column_List" />
    from e_recon_detail
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    delete from e_recon_detail
    where ID = #{id,jdbcType=INTEGER}
  </delete>
    <delete id="deleteByFilename" parameterType="java.lang.String">
        delete from e_recon_detail
          where FILE_NAME = #{filename}
    </delete>
  <insert id="insert" parameterType="com.cxdai.console.cgnotify.entity.EReconDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    insert into e_recon_detail (ID, HEADER_ID, TARGET_TYPE,
      TARGET_ID, TARGET_NAME, P2P_NO,
      BANK_NO, STATUS, TRADETIME,
      MONEY, MONEY2, FEE,
      STATUS2, STATUS3, EXP_TYPE,
      EXP1, EXP2, ADDUSER,
      ADDTIME, REMARK, FILE_NAME
      )
    values (#{id,jdbcType=INTEGER}, #{headerId,jdbcType=INTEGER}, #{targetType,jdbcType=TINYINT},
      #{targetId,jdbcType=VARCHAR}, #{targetName,jdbcType=VARCHAR}, #{p2pNo,jdbcType=VARCHAR},
      #{bankNo,jdbcType=VARCHAR}, #{status,jdbcType=TINYINT}, #{tradetime,jdbcType=TIMESTAMP},
      #{money,jdbcType=DECIMAL}, #{money2,jdbcType=DECIMAL}, #{fee,jdbcType=DECIMAL},
      #{status2,jdbcType=TINYINT}, #{status3,jdbcType=TINYINT}, #{expType,jdbcType=TINYINT},
      #{exp1,jdbcType=VARCHAR}, #{exp2,jdbcType=VARCHAR}, #{adduser,jdbcType=INTEGER},
      now(), #{remark,jdbcType=VARCHAR}, #{fileName,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.cxdai.console.cgnotify.entity.EReconDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    insert into e_recon_detail
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="headerId != null" >
        HEADER_ID,
      </if>
      <if test="targetType != null" >
        TARGET_TYPE,
      </if>
      <if test="targetId != null" >
        TARGET_ID,
      </if>
      <if test="targetName != null" >
        TARGET_NAME,
      </if>
      <if test="p2pNo != null" >
        P2P_NO,
      </if>
      <if test="bankNo != null" >
        BANK_NO,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="tradetime != null" >
        TRADETIME,
      </if>
      <if test="money != null" >
        MONEY,
      </if>
      <if test="money2 != null" >
        MONEY2,
      </if>
      <if test="fee != null" >
        FEE,
      </if>
      <if test="status2 != null" >
        STATUS2,
      </if>
      <if test="status3 != null" >
        STATUS3,
      </if>
      <if test="expType != null" >
        EXP_TYPE,
      </if>
      <if test="exp1 != null" >
        EXP1,
      </if>
      <if test="exp2 != null" >
        EXP2,
      </if>
      <if test="adduser != null" >
        ADDUSER,
      </if>
        ADDTIME,
      <if test="remark != null" >
        REMARK,
      </if>
      <if test="fileName != null" >
        FILE_NAME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="headerId != null" >
        #{headerId,jdbcType=INTEGER},
      </if>
      <if test="targetType != null" >
        #{targetType,jdbcType=TINYINT},
      </if>
      <if test="targetId != null" >
        #{targetId,jdbcType=VARCHAR},
      </if>
      <if test="targetName != null" >
        #{targetName,jdbcType=VARCHAR},
      </if>
      <if test="p2pNo != null" >
        #{p2pNo,jdbcType=VARCHAR},
      </if>
      <if test="bankNo != null" >
        #{bankNo,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=TINYINT},
      </if>
      <if test="tradetime != null" >
        #{tradetime,jdbcType=TIMESTAMP},
      </if>
      <if test="money != null" >
        #{money,jdbcType=DECIMAL},
      </if>
      <if test="money2 != null" >
        #{money2,jdbcType=DECIMAL},
      </if>
      <if test="fee != null" >
        #{fee,jdbcType=DECIMAL},
      </if>
      <if test="status2 != null" >
        #{status2,jdbcType=TINYINT},
      </if>
      <if test="status3 != null" >
        #{status3,jdbcType=TINYINT},
      </if>
      <if test="expType != null" >
        #{expType,jdbcType=TINYINT},
      </if>
      <if test="exp1 != null" >
        #{exp1,jdbcType=VARCHAR},
      </if>
      <if test="exp2 != null" >
        #{exp2,jdbcType=VARCHAR},
      </if>
      <if test="adduser != null" >
        #{adduser,jdbcType=INTEGER},
      </if>
        now(),
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null" >
        #{fileName,jdbcType=VARCHAR},
      </if>
    </trim>
      <selectKey keyProperty="id" resultType="integer" order="AFTER">
          SELECT LAST_INSERT_ID() AS ID
      </selectKey>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cxdai.console.cgnotify.entity.EReconDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    update e_recon_detail
    <set >
      <if test="headerId != null" >
        HEADER_ID = #{headerId,jdbcType=INTEGER},
      </if>
      <if test="targetType != null" >
        TARGET_TYPE = #{targetType,jdbcType=TINYINT},
      </if>
      <if test="targetId != null" >
        TARGET_ID = #{targetId,jdbcType=VARCHAR},
      </if>
      <if test="targetName != null" >
        TARGET_NAME = #{targetName,jdbcType=VARCHAR},
      </if>
      <if test="p2pNo != null" >
        P2P_NO = #{p2pNo,jdbcType=VARCHAR},
      </if>
      <if test="bankNo != null" >
        BANK_NO = #{bankNo,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=TINYINT},
      </if>
      <if test="tradetime != null" >
        TRADETIME = #{tradetime,jdbcType=TIMESTAMP},
      </if>
      <if test="money != null" >
        MONEY = #{money,jdbcType=DECIMAL},
      </if>
      <if test="money2 != null" >
        MONEY2 = #{money2,jdbcType=DECIMAL},
      </if>
      <if test="fee != null" >
        FEE = #{fee,jdbcType=DECIMAL},
      </if>
      <if test="status2 != null" >
        STATUS2 = #{status2,jdbcType=TINYINT},
      </if>
      <if test="status3 != null" >
        STATUS3 = #{status3,jdbcType=TINYINT},
      </if>
      <if test="expType != null" >
        EXP_TYPE = #{expType,jdbcType=TINYINT},
      </if>
      <if test="exp1 != null" >
        EXP1 = #{exp1,jdbcType=VARCHAR},
      </if>
      <if test="exp2 != null" >
        EXP2 = #{exp2,jdbcType=VARCHAR},
      </if>
      <if test="adduser != null" >
        ADDUSER = #{adduser,jdbcType=INTEGER},
      </if>
      <if test="addtime != null" >
        ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null" >
        FILE_NAME = #{fileName,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cxdai.console.cgnotify.entity.EReconDetail" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 10:02:28 CST 2016.
    -->
    update e_recon_detail
    set HEADER_ID = #{headerId,jdbcType=INTEGER},
      TARGET_TYPE = #{targetType,jdbcType=TINYINT},
      TARGET_ID = #{targetId,jdbcType=VARCHAR},
      TARGET_NAME = #{targetName,jdbcType=VARCHAR},
      P2P_NO = #{p2pNo,jdbcType=VARCHAR},
      BANK_NO = #{bankNo,jdbcType=VARCHAR},
      STATUS = #{status,jdbcType=TINYINT},
      TRADETIME = #{tradetime,jdbcType=TIMESTAMP},
      MONEY = #{money,jdbcType=DECIMAL},
      MONEY2 = #{money2,jdbcType=DECIMAL},
      FEE = #{fee,jdbcType=DECIMAL},
      STATUS2 = #{status2,jdbcType=TINYINT},
      STATUS3 = #{status3,jdbcType=TINYINT},
      EXP_TYPE = #{expType,jdbcType=TINYINT},
      EXP1 = #{exp1,jdbcType=VARCHAR},
      EXP2 = #{exp2,jdbcType=VARCHAR},
      ADDUSER = #{adduser,jdbcType=INTEGER},
      ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      REMARK = #{remark,jdbcType=VARCHAR},
      FILE_NAME = #{fileName,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>

  <select id="findReconDetail" resultMap="BaseResultMap">
  	 select
    <include refid="Base_Column_List"/>
    from e_recon_detail
    where TARGET_ID=#{targetId} and TARGET_TYPE=#{targetType}
  </select>

  <select id="findReconDetailMoney" resultType="java.math.BigDecimal">
  select sum(MONEY) from e_recon_detail where TARGET_ID=#{targetId} and TARGET_TYPE=#{targetType}
  
  </select>


  <!-- =========还款使用 START ============ -->
  <select id="queryDetailP2PNoList" resultType="String">
    SELECT
    P2P_NO
    FROM
    e_recon_detail
    WHERE TARGET_TYPE=#{targetType}
    AND TARGET_ID=#{targetId}
    AND FILE_NAME=#{fileName}
    AND STATUS=#{status}
  </select>

  <select id="queryDetailMoney" resultType="java.math.BigDecimal">
    SELECT
      MONEY
    FROM
      e_recon_detail
    WHERE P2P_NO=#{p2pNo} and STATUS=4
  </select>


  <select id="queryDetail" resultMap="BaseResultMap">
    select
      <include refid="Base_Column_List"/>
    FROM
      e_recon_detail
    WHERE
          TARGET_TYPE=#{targetType}
      AND TARGET_ID=#{targetId}
      AND FILE_NAME=#{fileName}
      AND STATUS=#{status}
      AND P2P_NO=#{p2pNo}
  </select>

  <select id="queryOneDetail" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    FROM
      e_recon_detail
    WHERE
      TARGET_TYPE=#{targetType}
      AND TARGET_ID=#{targetId}
      AND FILE_NAME=#{fileName}
      ORDER BY ADDTIME DESC LIMIT 1
  </select>
  <!-- =========还款使用 END ============ -->

    <select id="sumReconDetailByCnd" parameterType="com.cxdai.console.cgnotify.vo.ReconResultCnd" resultType="java.util.Map">
  select *
	from
		(select IFNULL(SUM(rc.MONEY),0) AS czbankRechargeMoney
			from rocky_rechargerecord rc
			inner join e_recon_detail rd
				on rc.IS_CUSTODY = 1
					and rd.TARGET_TYPE = 4
					and rd.STATUS = 4
					and rd.EXP_TYPE = 5
					and rc.E_TRADE_NO = rd.BANK_NO
					and rc.MONEY = rd.MONEY
					and rc.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and rd.TRADETIME <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and rd.TRADETIME <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
		) AS czbankRechargeMoney,
		(select IFNULL(SUM(rc.TOTAL),0) AS czbankTakeCashMoney
			from rocky_cashrecord rc
			inner join e_recon_detail rd
				on rc.IS_CUSTODY = 1
					and rd.TARGET_TYPE = 4
					and rd.STATUS = 4
					and rd.EXP_TYPE = 6
					and rc.E_TRADE_NO = rd.BANK_NO
					and rc.TOTAL = rd.MONEY
					and rc.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and rd.TRADETIME <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and rd.TRADETIME <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
		) AS czbankTakeCashMoney,
		(select IFNULL(SUM(rc.ACCOUNT),0) AS czbankInvestMoney
				from rocky_b_tenderrecord rc
				inner join e_recon_detail rd
					on rc.IS_CUSTODY = 1
						and rd.TARGET_TYPE = 4
						and rd.STATUS = 4
						and rd.EXP_TYPE = 3
						and rc.E_FREEZE_NO = rd.BANK_NO
						and rc.ACCOUNT = rd.MONEY
						and rc.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and rd.TRADETIME <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and rd.TRADETIME <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
		) AS czbankInvestMoney,
		(select IFNULL(SUM(rc.ACCOUNT),0) AS czbankInvestSuccessMoney
				from rocky_b_tenderrecord rc
				inner join e_recon_detail rd
					on rc.IS_CUSTODY = 1
						and rd.TARGET_TYPE = 4
						and rd.STATUS = 4
						and rd.EXP_TYPE = 18
						and rc.E_INVEST_NO = rd.BANK_NO
						and rc.ACCOUNT = rd.MONEY
						and rc.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and rd.TRADETIME <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and rd.TRADETIME <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
		) AS czbankInvestSuccessMoney
    </select>

    <select id="sumTenderRecordByCnd" resultType="java.util.Map">
  select *
	from
	(
	select IFNULL(SUM(rbt.ACCOUNT),0) AS sysInvestMoney
		from rocky_borrow rb
		inner join rocky_b_tenderrecord rbt
			on rb.ID = rbt.BORROW_ID
				and rb.IS_CUSTODY = 1
				and rbt.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and FROM_UNIXTIME(rbt.ADDTIME) <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and FROM_UNIXTIME(rbt.ADDTIME) <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
	) AS sysInvestMoney,
	(
	select IFNULL(SUM(rbt.ACCOUNT),0) AS sysInvestSuccessMoney
		from rocky_borrow rb
		inner join rocky_b_tenderrecord rbt
			on rb.ID = rbt.BORROW_ID
				and rb.IS_CUSTODY = 1
				and rbt.IS_CUSTODY = 1
        <if test="beginTimeStr != null and beginTimeStr != '' ">
            and FROM_UNIXTIME(rbt.E_INVEST_DATE) <![CDATA[>=]]> from_unixtime(#{beginTimeStr})
        </if>
        <if test="endTimeStr != null and endTimeStr != '' ">
            and FROM_UNIXTIME(rbt.E_INVEST_DATE) <![CDATA[<=]]> from_unixtime(#{endTimeStr})
        </if>
	) AS sysInvestSuccessMoney
    </select>

</mapper>