<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cxdai.console.borrow.manage.mapper.EFundRepayMentMapper" >
  <resultMap id="BaseResultMap" type="com.cxdai.console.borrow.manage.vo.EFundRepayMent" >
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="TYPE" property="type" jdbcType="INTEGER" />
    <result column="BORROW_ID" property="borrowId" jdbcType="INTEGER" />
    <result column="REAPAYMENT_ID" property="reapaymentId" jdbcType="INTEGER" />
    <result column="COLLECTION_ID" property="collectionId" jdbcType="INTEGER" />
    <result column="ORDER" property="order" jdbcType="INTEGER" />
    <result column="REPAY_NAME" property="repayName" jdbcType="VARCHAR" />
    <result column="INNER_FLAG" property="innerFlag" jdbcType="INTEGER" />
    <result column="BIZ_NO" property="bizNo" jdbcType="VARCHAR" />
    <result column="E_INVEST_NO" property="eInvestNo" jdbcType="VARCHAR" />
    <result column="E_REPAYMENT_NO" property="eRepaymentNo" jdbcType="VARCHAR" />
    <result column="RETURN_TYPE" property="returnType" jdbcType="INTEGER" />
    <result column="FLAG" property="flag" jdbcType="INTEGER" />
    <result column="BANK_BRANCH_NO" property="bankBranchNo" jdbcType="VARCHAR" />
    <result column="ACCOUNT_BANK_NUMBER" property="accountBankNumber" jdbcType="VARCHAR" />
    <result column="ACCOUNT_NAME" property="accountName" jdbcType="VARCHAR" />
    <result column="REPAYMENT_AMOUNT" property="repaymentAmount" jdbcType="INTEGER" />
    <result column="FEE" property="fee" jdbcType="INTEGER" />
    <result column="EXTRA_INTEREST" property="extraInterest" jdbcType="INTEGER" />
    <result column="CURRENCY" property="currency" jdbcType="INTEGER" />
    <result column="PAY_TYPE" property="payType" jdbcType="INTEGER" />
    <result column="IS_SEND" property="isSend" jdbcType="INTEGER" />
    <result column="RESULT" property="result" jdbcType="INTEGER" />
    <result column="ATTACH_AMOUNT" property="attachAmount" jdbcType="INTEGER" />
    <result column="ADDTIME" property="addtime" jdbcType="TIMESTAMP" />
    <result column="UPDATETIME" property="updatetime" jdbcType="TIMESTAMP" />
    <result column="E_PROJECTID" property="eProjectId" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    ID, TYPE, BORROW_ID, REAPAYMENT_ID, COLLECTION_ID, `ORDER`, REPAY_NAME, INNER_FLAG, 
    BIZ_NO, E_INVEST_NO, E_REPAYMENT_NO, RETURN_TYPE, FLAG, BANK_BRANCH_NO, ACCOUNT_BANK_NUMBER, 
    ACCOUNT_NAME, REPAYMENT_AMOUNT, FEE, EXTRA_INTEREST, CURRENCY, PAY_TYPE, IS_SEND, 
    RESULT, ATTACH_AMOUNT, ADDTIME, UPDATETIME,E_PROJECTID
  </sql>
  
  <!-- 封装查询条件 -->
	<sql id="RepayMent_Where_Clause">
		<if test="id != null">
			and ID =#{id}
		</if>
		<if test="type != null">
			and TYPE = #{type}
		</if>
		<if test="collectionId != null">
			and COLLECTION_ID = #{collectionId}
		</if>
		<if test="reapaymentId != null">
			and REAPAYMENT_ID = #{reapaymentId}
		</if>
        <if test="order != null">
          and `ORDER` = #{order}
        </if>
        <if test="addtime != null">
          and DATE_FORMAT(ADDTIME,'%Y%m%d') = DATE_FORMAT(#{addtime},'%Y%m%d')
        </if>
        <if test="isSend != null">
          and IS_SEND = #{isSend}
        </if>
    </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 17 14:51:20 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from e_fund_repayment
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <insert id="insert" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 17 14:51:20 CST 2016.
    -->
    insert into e_fund_repayment (TYPE, BORROW_ID, 
      REAPAYMENT_ID, COLLECTION_ID, `ORDER`, 
      REPAY_NAME, INNER_FLAG, BIZ_NO, 
      E_INVEST_NO, E_REPAYMENT_NO, RETURN_TYPE, 
      FLAG, BANK_BRANCH_NO, ACCOUNT_BANK_NUMBER, 
      ACCOUNT_NAME, REPAYMENT_AMOUNT, FEE, 
      EXTRA_INTEREST, CURRENCY, PAY_TYPE, 
      IS_SEND, RESULT, ATTACH_AMOUNT,
      ADDTIME, UPDATETIME,E_ProjectID)
    values ( #{type,jdbcType=INTEGER}, #{borrowId,jdbcType=INTEGER}, 
      #{reapaymentId,jdbcType=INTEGER}, #{collectionId,jdbcType=INTEGER}, #{order,jdbcType=INTEGER}, 
      #{repayName,jdbcType=VARCHAR}, #{innerFlag,jdbcType=INTEGER}, #{bizNo,jdbcType=VARCHAR}, 
      #{eInvestNo,jdbcType=VARCHAR}, #{eRepaymentNo,jdbcType=VARCHAR}, #{returnType,jdbcType=INTEGER}, 
      #{flag,jdbcType=INTEGER}, #{bankBranchNo,jdbcType=VARCHAR}, #{accountBankNumber,jdbcType=VARCHAR}, 
      #{accountName,jdbcType=VARCHAR}, #{repaymentAmount,jdbcType=INTEGER}, #{fee,jdbcType=INTEGER}, 
      #{extraInterest,jdbcType=INTEGER}, #{currency,jdbcType=INTEGER}, #{payType,jdbcType=INTEGER}, 
      #{isSend,jdbcType=INTEGER}, #{result,jdbcType=INTEGER}, #{attachAmount,jdbcType=INTEGER},
      CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, #{eProjectId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMent" >
    insert into e_fund_repayment
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="type != null" >
        TYPE,
      </if>
      <if test="borrowId != null" >
        BORROW_ID,
      </if>
      <if test="reapaymentId != null" >
        REAPAYMENT_ID,
      </if>
      <if test="collectionId != null" >
        COLLECTION_ID,
      </if>
      <if test="order != null" >
        ORDER,
      </if>
      <if test="repayName != null" >
        REPAY_NAME,
      </if>
      <if test="innerFlag != null" >
        INNER_FLAG,
      </if>
      <if test="bizNo != null" >
        BIZ_NO,
      </if>
      <if test="eInvestNo != null" >
        E_INVEST_NO,
      </if>
      <if test="eRepaymentNo != null" >
        E_REPAYMENT_NO,
      </if>
      <if test="returnType != null" >
        RETURN_TYPE,
      </if>
      <if test="flag != null" >
        FLAG,
      </if>
      <if test="bankBranchNo != null" >
        BANK_BRANCH_NO,
      </if>
      <if test="accountBankNumber != null" >
        ACCOUNT_BANK_NUMBER,
      </if>
      <if test="accountName != null" >
        ACCOUNT_NAME,
      </if>
      <if test="repaymentAmount != null" >
        REPAYMENT_AMOUNT,
      </if>
      <if test="fee != null" >
        FEE,
      </if>
      <if test="extraInterest != null" >
        EXTRA_INTEREST,
      </if>
      <if test="currency != null" >
        CURRENCY,
      </if>
      <if test="payType != null" >
        PAY_TYPE,
      </if>
      <if test="isSend != null" >
        IS_SEND,
      </if>
      <if test="result != null" >
        RESULT,
      </if>
      <if test="attachAmount != null" >
        ATTACH_AMOUNT,
      </if>
      <if test="addtime != null" >
        ADDTIME,
      </if>
      <if test="updatetime != null" >
        UPDATETIME,
      </if>
       <if test="collectionId != null" >
        E_ProjectID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        #{type,jdbcType=INTEGER},
      </if>
      <if test="borrowId != null" >
        #{borrowId,jdbcType=INTEGER},
      </if>
      <if test="reapaymentId != null" >
        #{reapaymentId,jdbcType=INTEGER},
      </if>
      <if test="collectionId != null" >
        #{collectionId,jdbcType=INTEGER},
      </if>
      <if test="order != null" >
        #{order,jdbcType=INTEGER},
      </if>
      <if test="repayName != null" >
        #{repayName,jdbcType=VARCHAR},
      </if>
      <if test="innerFlag != null" >
        #{innerFlag,jdbcType=INTEGER},
      </if>
      <if test="bizNo != null" >
        #{bizNo,jdbcType=VARCHAR},
      </if>
      <if test="eInvestNo != null" >
        #{eInvestNo,jdbcType=VARCHAR},
      </if>
      <if test="eRepaymentNo != null" >
        #{eRepaymentNo,jdbcType=VARCHAR},
      </if>
      <if test="returnType != null" >
        #{returnType,jdbcType=INTEGER},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=INTEGER},
      </if>
      <if test="bankBranchNo != null" >
        #{bankBranchNo,jdbcType=VARCHAR},
      </if>
      <if test="accountBankNumber != null" >
        #{accountBankNumber,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null" >
        #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="repaymentAmount != null" >
        #{repaymentAmount,jdbcType=INTEGER},
      </if>
      <if test="fee != null" >
        #{fee,jdbcType=INTEGER},
      </if>
      <if test="extraInterest != null" >
        #{extraInterest,jdbcType=INTEGER},
      </if>
      <if test="currency != null" >
        #{currency,jdbcType=INTEGER},
      </if>
      <if test="payType != null" >
        #{payType,jdbcType=INTEGER},
      </if>
      <if test="isSend != null" >
        #{isSend,jdbcType=INTEGER},
      </if>
      <if test="result != null" >
        #{result,jdbcType=INTEGER},
      </if>
      <if test="attachAmount != null" >
        #{attachAmount,jdbcType=INTEGER},
      </if>
      <if test="addtime != null" >
        #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        #{updatetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 17 14:51:20 CST 2016.
    -->
    update e_fund_repayment
    <set >
      <if test="type != null" >
        TYPE = #{type,jdbcType=INTEGER},
      </if>
      <if test="borrowId != null" >
        BORROW_ID = #{borrowId,jdbcType=INTEGER},
      </if>
      <if test="reapaymentId != null" >
        REAPAYMENT_ID = #{reapaymentId,jdbcType=INTEGER},
      </if>
      <if test="collectionId != null" >
        COLLECTION_ID = #{collectionId,jdbcType=INTEGER},
      </if>
      <if test="order != null" >
        `ORDER` = #{order,jdbcType=INTEGER},
      </if>
      <if test="repayName != null" >
        REPAY_NAME = #{repayName,jdbcType=VARCHAR},
      </if>
      <if test="innerFlag != null" >
        INNER_FLAG = #{innerFlag,jdbcType=INTEGER},
      </if>
      <if test="bizNo != null" >
        BIZ_NO = #{bizNo,jdbcType=VARCHAR},
      </if>
      <if test="eInvestNo != null" >
        E_INVEST_NO = #{eInvestNo,jdbcType=VARCHAR},
      </if>
      <if test="eRepaymentNo != null" >
        E_REPAYMENT_NO = #{eRepaymentNo,jdbcType=VARCHAR},
      </if>
      <if test="returnType != null" >
        RETURN_TYPE = #{returnType,jdbcType=INTEGER},
      </if>
      <if test="flag != null" >
        FLAG = #{flag,jdbcType=INTEGER},
      </if>
      <if test="bankBranchNo != null" >
        BANK_BRANCH_NO = #{bankBranchNo,jdbcType=VARCHAR},
      </if>
      <if test="accountBankNumber != null" >
        ACCOUNT_BANK_NUMBER = #{accountBankNumber,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null" >
        ACCOUNT_NAME = #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="repaymentAmount != null" >
        REPAYMENT_AMOUNT = #{repaymentAmount,jdbcType=INTEGER},
      </if>
      <if test="fee != null" >
        FEE = #{fee,jdbcType=INTEGER},
      </if>
      <if test="extraInterest != null" >
        EXTRA_INTEREST = #{extraInterest,jdbcType=INTEGER},
      </if>
      <if test="currency != null" >
        CURRENCY = #{currency,jdbcType=INTEGER},
      </if>
      <if test="payType != null" >
        PAY_TYPE = #{payType,jdbcType=INTEGER},
      </if>
      <if test="isSend != null" >
        IS_SEND = #{isSend,jdbcType=INTEGER},
      </if>
      <if test="result != null" >
        RESULT = #{result,jdbcType=INTEGER},
      </if>
      <if test="attachAmount != null" >
        ATTACH_AMOUNT = #{attachAmount,jdbcType=INTEGER},
      </if>
      <if test="addtime != null" >
        ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        UPDATETIME = CURRENT_TIMESTAMP,
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMent" >
    update e_fund_repayment
    set TYPE = #{type,jdbcType=INTEGER},
      BORROW_ID = #{borrowId,jdbcType=INTEGER},
      REAPAYMENT_ID = #{reapaymentId,jdbcType=INTEGER},
      COLLECTION_ID = #{collectionId,jdbcType=INTEGER},
      ORDER = #{order,jdbcType=INTEGER},
      REPAY_NAME = #{repayName,jdbcType=VARCHAR},
      INNER_FLAG = #{innerFlag,jdbcType=INTEGER},
      BIZ_NO = #{bizNo,jdbcType=VARCHAR},
      E_INVEST_NO = #{eInvestNo,jdbcType=VARCHAR},
      E_REPAYMENT_NO = #{eRepaymentNo,jdbcType=VARCHAR},
      RETURN_TYPE = #{returnType,jdbcType=INTEGER},
      FLAG = #{flag,jdbcType=INTEGER},
      BANK_BRANCH_NO = #{bankBranchNo,jdbcType=VARCHAR},
      ACCOUNT_BANK_NUMBER = #{accountBankNumber,jdbcType=VARCHAR},
      ACCOUNT_NAME = #{accountName,jdbcType=VARCHAR},
      REPAYMENT_AMOUNT = #{repaymentAmount,jdbcType=INTEGER},
      FEE = #{fee,jdbcType=INTEGER},
      EXTRA_INTEREST = #{extraInterest,jdbcType=INTEGER},
      CURRENCY = #{currency,jdbcType=INTEGER},
      PAY_TYPE = #{payType,jdbcType=INTEGER},
      IS_SEND = #{isSend,jdbcType=INTEGER},
      RESULT = #{result,jdbcType=INTEGER},
      ATTACH_AMOUNT = #{attachAmount,jdbcType=INTEGER},
      ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      UPDATETIME = CURRENT_TIMESTAMP
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="selectByRepayId" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select  <include refid="Base_Column_List" />
    from e_fund_repayment
    where REAPAYMENT_ID = #{reapaymentId,jdbcType=INTEGER}
          AND BORROW_ID = #{borrowId,jdbcType=INTEGER}
          AND IS_SEND = 0
          AND TYPE = #{type,jdbcType=INTEGER}
  </select>

  
   <!-- 根据相应更新本息还款数据表 -->
  	<update id="updateByResponse" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMentCnd" >
		update e_fund_repayment set E_REPAYMENT_NO=#{eRepaymentNo},result=#{result},updatetime=CURRENT_TIMESTAMP,is_send=1
		where BIZ_NO=#{bizNo}
		      AND IS_SEND=0
		      AND TYPE=#{type}
		      AND REAPAYMENT_ID = #{reapaymentId}
  	</update>
  	
     <!-- 根据条件查询记录数量-->
	<select id="queryRepayMentCount" parameterType="com.cxdai.console.borrow.manage.vo.EFundRepayMentCnd" resultType="java.lang.Integer" >
		select count(id)
		from
			e_fund_repayment 
		where 1=1
		<include refid="RepayMent_Where_Clause"/>
  	</select>


    <select id="selectCollectionId" resultMap="BaseResultMap" parameterType="java.util.Map" >
      select  <include refid="Base_Column_List" />
      from e_fund_repayment
      where COLLECTION_ID= #{collectionId} AND RESULT = #{result}
    </select>

  <select id="queryEfendRepayByProject" resultMap="BaseResultMap" >
    select  <include refid="Base_Column_List" />
    from e_fund_repayment
    where E_PROJECTID= #{eProject} AND RESULT = 20 AND IS_SEND = 1
    order by `ORDER` DESC,ADDTIME DESC LIMIT 1
  </select>
</mapper>